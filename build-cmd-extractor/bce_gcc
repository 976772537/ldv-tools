#!/usr/bin/perl

use FindBin;
use SOAP::Lite service =>"$ENV{'WSDLADDR'}?wsdl";

my $as_gcc = "$FindBin::Bin/../cmd-utils/as_gcc";
if(!$as_gcc || !(-f $as_gcc)) {
        print "bce_gcc: ERROR: Can't find as_gcc: \"$as_gcc\".\n";
        exit 1;
}


# search and replace .ko with .o extension
#
my $module_file = $ARGV[0];
if(!($module_file =~ s/\.ko$/\.o/)) 
{
	if(!($module_file =~ s/\.ko.unsigned$/\.o/)) {
		print "bce_gcc: ERROR: Can't replcae .ko with .o in module_file.\n";
		exit 1;
	}
}

if(isExistsLD(SOAP::Data-> type("string") -> name ("arg0") -> value ($module_file)) eq 'true') {
	marker(SOAP::Data-> type ("string") -> name ("arg0") -> value ($module_file));
} else {
	# Else you must send artificial command !
	@as_gcc_out = `$as_gcc $module_file -o $ARGV[0]`;
#	my $cmd_id = 0;
#	foreach (@as_gcc_out) {
#		/<ID>(.*)<\/ID>/ or next;
#		
#	}
	marker(SOAP::Data-> type ("string") -> name ("arg0") -> value ($ARGV[0]));
}

