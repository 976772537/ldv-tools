<?php

include 'general.php';

// Get all infomation to be displayed.
$results = $this->entries;

// Print error if so.
if (isset($this->error)) {
  echo $this->error;
}
else {
  print_r($results['Error trace']->errorTrace);
  
  // Print KB records relevant to a given error trace.
  $kbRecords = $results['Knowledge base'];
  echo "<table id='SETVKBTable' border='1'>";
  echo '<tr>';
  foreach (array_keys($kbRecords[0]) as $columnName) {
    echo "<td>$columnName</td>";
  }
  foreach ($kbRecords as $kbRecord) {
    echo '<tr>';
    foreach ($kbRecord as $columnName => $kbCellValue) {
      echo "<td class='SETVKB" . preg_replace('/\s*/', '', $columnName) . "'>$kbCellValue</td>";
    }
    echo '</tr>';
  }
  echo '</tr>';
  echo '</table>';
}

// Print show/hide plugin for error trace visualizer help. By default it isn't shown.
echo "<script type='text/javascript'>
        $(document).ready(function() {
          $('.ETVHelp').before('<div id=\"SETVHelpShowHide\"><a href=\"#\" id=\"SETVHelpShowHideLink\">Error trace visualizer help</a></div>');
          $('#SETVHelpShowHideLink').toggle(function() {
            $('.ETVHelp').show();
            return false;
          } , function() {
            $('.ETVHelp').hide();
            return false;
          });
        });
      </script>";

// Print show/hide plugin for error trace visualizer log. By default it isn't shown.
echo "<script type='text/javascript'>
        $(document).ready(function() {
          $('#SETVLogShowHideLink').toggle(function() {
            $('#SETVLog').show();
            return false;
          } , function() {
            $('#SETVLog').hide();
            return false;
          });
        });
      </script>";

echo "<div id='SETVLogShowHide'><a href='#' id='SETVLogShowHideLink'>Error trace visualizer log</a></div>";

echo "<div id='SETVLog' style='display: none;'>";
echo implode('<br />', $results['ETV log']);
echo "</div>";

printInfo($results);

?>
